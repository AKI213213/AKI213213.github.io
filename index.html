<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学</title>
    <!-- 引入echarts.min.js -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
    <!-- 引入SheetJS（xlsx）库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js"></script>
    <style>
        #main {
            width: 100%;
            height: 550px;
        }
    </style>
</head>
<body>
<div id="main"></div>
<!-- 文件选择和读取 -->
<input type="file" id="file-input" />

<script>
    // 处理Excel文件的读取
    document.getElementById('file-input').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // 假设数据在第一个sheet里
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];

                // 将sheet数据转换为JSON格式
                const jsonData = XLSX.utils.sheet_to_json(sheet);

                // 提取数据并填充到ECharts的配置项中
                const xData = [];
                const historyHighest = [];
                const physicsHighest = [];
                const historyLine = [];
                const physicsLine = [];
                const highestScore = [];
                const lowestScore = [];

                jsonData.forEach(row => {
                    xData.push(row["日期"] || ""); // 假设Excel有“日期”列
                    historyHighest.push(row["历史最高分"] || 0);
                    physicsHighest.push(row["物理最高分"] || 0);
                    historyLine.push(row["历史班本科线"] || 0);
                    physicsLine.push(row["物理班本科线"] || 0);
                    highestScore.push(row["最高分"] || 0);
                    lowestScore.push(row["最低分"] || 0);
                });

                // 更新ECharts配置项
                const option = {
                    title: { text: '数学' },
                    tooltip: {
                        show: true,
                        trigger: 'axis',
                        axisPointer: { type: 'shadow' },
                        formatter: function (params) {
                            let result = '';
                            params.forEach(function (param) {
                                result += param.marker + param.seriesName + ': ' + param.value + '<br>';
                            });
                            return result;
                        }
                    },
                    axisLabel: { interval: 0, fontSize: 10 },
                    dataZoom: [{
                        type: 'inside',
                        start: 0,
                        end: 100
                    }, {
                        show: true,
                        type: 'slider',
                        top: '90%',
                        start: 0,
                        end: 100
                    }],
                    legend: {
                        data: ['历史最高分', '物理最高分', '历史班本科线', '物理班本科线', '最高分', '最低分']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '11%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: xData,
                        nameGap: 10,
                        axisTick: { alignWithLabel: true },
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: 150,
                    },
                    series: [
                        {
                            name: '历史最高分',
                            type: 'bar',
                            data: historyHighest
                        },
                        {
                            name: '物理最高分',
                            type: 'bar',
                            data: physicsHighest
                        },
                        {
                            name: '历史班本科线',
                            type: 'line',
                            data: historyLine
                        },
                        {
                            name: '物理班本科线',
                            type: 'line',
                            data: physicsLine
                        },
                        {
                            name: '最高分',
                            type: 'scatter',
                            data: highestScore
                        },
                        {
                            name: '最低分',
                            type: 'scatter',
                            data: lowestScore
                        }
                    ]
                };

                const myChart = echarts.init(document.getElementById('main'));
                myChart.setOption(option);
            };
            reader.readAsArrayBuffer(file); // 读取文件
        }
    });
</script>
</body>
</html>
